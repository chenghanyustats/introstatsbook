<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.555">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta name="description" content="A comprehensive introductory statistical data science book.">
<title>Introduction to Statistics - 23&nbsp; Analysis of Variance</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>

<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./model-multicomp.html" rel="next">
<link href="./model.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="site_libs/bootstrap/bootstrap-dark.min.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark"><script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script><script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script><link rel="stylesheet" href="custom.css">
</head>
<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top"><nav class="quarto-secondary-nav"><div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./model.html">Statistical Models</a></li><li class="breadcrumb-item"><a href="./model-anova.html"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Analysis of Variance</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav></header><!-- content --><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto"><div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to Statistics</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://github.com/chenghanyustats/introstatsbook" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
    <a href="./Introduction-to-Statistics.pdf" title="Download PDF" class="quarto-navigation-tool px-1" aria-label="Download PDF"><i class="bi bi-file-pdf"></i></a>
    <div class="dropdown">
      <a href="" title="Share" id="quarto-navigation-tool-dropdown-0" class="quarto-navigation-tool dropdown-toggle px-1" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Share"><i class="bi bi-share"></i></a>
      <ul class="dropdown-menu" aria-labelledby="quarto-navigation-tool-dropdown-0">
<li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://twitter.com/intent/tweet?url=%7Curl%7C">
              <i class="bi bi-bi-twitter pe-1"></i>
            Twitter
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.facebook.com/sharer/sharer.php?u=%7Curl%7C">
              <i class="bi bi-bi-facebook pe-1"></i>
            Facebook
            </a>
          </li>
          <li>
            <a class="dropdown-item sidebar-tools-main-item" href="https://www.linkedin.com/sharing/share-offsite/?url=%7Curl%7C">
              <i class="bi bi-bi-linkedin pe-1"></i>
            LinkedIn
            </a>
          </li>
      </ul>
</div>
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistics and Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro-stats.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Science of Data and Data Science</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro-data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Data Collection and Data Type</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro-r.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Tool foR Data</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./datasummary.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Summarizing Data</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-graphics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Data Visualization</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./data-numerics.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Numerical Measures of Data</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./prob.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Probability</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prob-define.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Definition of Probability</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prob-rule.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Probability Rules and Bayes Formula</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prob-rv.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Random Variables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prob-disc.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Discrete Probability Distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prob-cont.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Continuous Probability Distributions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prob-sampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">Random Sampling and Sampling Distribution</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prob-llnclt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">Law of Large Numbers and Central Limit Theorem</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./infer.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistical Inference</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./infer-ci.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">Point and Interval Estimation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./infer-bt.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Bootstrapping</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./infer-ht.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">Hypothesis Testing</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./infer-twomean.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">Comparing Two Population Means</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./infer-var.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">Inference About Variances</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./infer-prop.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">Inference About Proportions</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./infer-cat.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">Inference about Categorical Data</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./infer-p.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">The Issues of <span class="math inline">\(p\)</span>-value and Statistical Significance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./infer-bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">Bayesian Thinking and Inference</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./infer-nonpar.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">Nonparametric Tests</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a href="./model.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Statistical Models</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model-anova.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Analysis of Variance</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model-multicomp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Multiple Comparison*</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model-twoway.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">Two-Way ANOVA*</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model-reg.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">Simple Linear Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model-mlr.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">Multiple Linear Regression*</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model-logistic.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">Logistic Regression</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model-bayes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">Bayesian Linear Regression*</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./model-survival.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">Survival Analysis</span></span></a>
  </div>
</li>
      </ul>
</li>
        <li class="sidebar-item sidebar-item-section">
      <span class="sidebar-item-text sidebar-link text-start">
 <span class="menu-text">References</span></span>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">Appendices</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">
<li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./a-r_prog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">A</span>&nbsp; <span class="chapter-title">R programming</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./a-py_prog.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">B</span>&nbsp; <span class="chapter-title">Python Programming</span></span></a>
  </div>
</li>
      </ul>
</li>
    </ul>
</div>
</nav><div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active"><h2 id="toc-title">Table of contents</h2>
   
  <ul>
<li><a href="#anova-rationale" id="toc-anova-rationale" class="nav-link active" data-scroll-target="#anova-rationale"><span class="header-section-number">23.1</span> ANOVA Rationale</a></li>
  <li><a href="#anova-procedures" id="toc-anova-procedures" class="nav-link" data-scroll-target="#anova-procedures"><span class="header-section-number">23.2</span> ANOVA Procedures</a></li>
  <li><a href="#anova-example" id="toc-anova-example" class="nav-link" data-scroll-target="#anova-example"><span class="header-section-number">23.3</span> ANOVA Example</a></li>
  <li>
<a href="#unequal-variances" id="toc-unequal-variances" class="nav-link" data-scroll-target="#unequal-variances"><span class="header-section-number">23.4</span> Unequal Variances</a>
  <ul class="collapse">
<li><a href="#example-of-unequal-variances-example-8.4-smd" id="toc-example-of-unequal-variances-example-8.4-smd" class="nav-link" data-scroll-target="#example-of-unequal-variances-example-8.4-smd"><span class="header-section-number">23.4.1</span> Example of Unequal Variances (Example 8.4 SMD)</a></li>
  </ul>
</li>
  <li>
<a href="#anova-mathematical-model" id="toc-anova-mathematical-model" class="nav-link" data-scroll-target="#anova-mathematical-model"><span class="header-section-number">23.5</span> ANOVA Mathematical Model*</a>
  <ul class="collapse">
<li><a href="#check-assumption-that-epsilon_ij-sim-n0-sigma2" id="toc-check-assumption-that-epsilon_ij-sim-n0-sigma2" class="nav-link" data-scroll-target="#check-assumption-that-epsilon_ij-sim-n0-sigma2"><span class="header-section-number">23.5.1</span> Check Assumption that <span class="math inline">\(\epsilon_{ij} \sim N(0, \sigma^2)\)</span></a></li>
  </ul>
</li>
  <li><a href="#nonparametric-approach-kruskal-wallis-test" id="toc-nonparametric-approach-kruskal-wallis-test" class="nav-link" data-scroll-target="#nonparametric-approach-kruskal-wallis-test"><span class="header-section-number">23.6</span> Nonparametric Approach: Kruskal-Wallis Test</a></li>
  </ul><div class="toc-actions"><ul><li><a href="https://github.com/chenghanyustats/introstatsbook/edit/main/model-anova.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/chenghanyustats/introstatsbook/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content"><header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./model.html">Statistical Models</a></li><li class="breadcrumb-item"><a href="./model-anova.html"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Analysis of Variance</span></a></li></ol></nav><div class="quarto-title">
<h1 class="title"><span id="sec-model-anova" class="quarto-section-identifier"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">Analysis of Variance</span></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header><p><span style="color:blue"> <strong>Comparing More Than Two Population Means</strong> </span></p>
<p>We have learned how to compare two population means in <a href="infer-twomean.html" class="quarto-xref"><span>Chapter 16</span></a>. However, in many research settings and questions, we want to compare three or more population means. For example,</p>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li><span style="color:blue"> Are there differences in the mean readings of 4 types of devices used to determine the pH of soil samples? </span></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./images/img-model/soil.jpeg" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption>Source: Unsplash-Markus Spiske.</figcaption></figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<ul>
<li><span style="color:blue"> Do different treatments (None, Fertilizer, Irrigation, Fertilizer and Irrigation) affect the mean weights of poplar trees? </span></li>
</ul>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./images/img-model/poplar.jpeg" class="img-fluid figure-img" style="width:80.0%"></p>
<figcaption>Source: Unsplash-Nareeta Martin.</figcaption></figure>
</div>
</div>
</div>
</div>
</div>
<!-- ------------------------------------------------------------------------ -->
<p>In both cases, four means are compared. The two-sample <span class="math inline">\(z\)</span> or <span class="math inline">\(t\)</span> test cannot be used anymore. Our solution is the <strong>analysis of variance</strong>, or <strong>ANOVA</strong>.</p>
<section id="anova-rationale" class="level2" data-number="23.1"><h2 data-number="23.1" class="anchored" data-anchor-id="anova-rationale">
<span class="header-section-number">23.1</span> ANOVA Rationale</h2>
<p><span style="color:blue"> <strong>One-Way Analysis of Variance</strong> </span></p>
<p>A <strong>factor</strong> (treatment) is a property or characteristic (categorical variable) that allows us to <em>distinguish the different populations from one another</em>. In fact, when we compare two population means, the two samples are from the populations separated by the categories of a factor. For example, we have gender as a factor that separates the human population into male and female populations, then we compare their mean salary. In our previous examples, <em>type of device</em> and <em>treatment of trees</em> are factors.</p>
<p>One-way ANOVA examines the effect of single <em>categorical variable</em> on the <em>mean of a numerical variable</em>. The ANOVA model is one-way because there is only one factor being considered. If two factors are examined to see how they affect the mean of a numerical variable, the model is called two-way ANOVA. The numerical variable in ANOVA or regression model (<a href="model-reg.html" class="quarto-xref"><span>Chapter 26</span></a>) is called the <strong>response variable</strong> because we want to see how the variable responses to the changes of factors or other variables.</p>
<p>Interestingly, we analyze <span style="color:red"> variances </span> to test the equality of three or more population <span style="color:red"> means</span> ðŸ¤”. It sounds counterintuitive, but later you will see why this makes sense.</p>
<p><!-- + The method is **one-way** because we use one single property (categorical variable) for categorizing the populations. --></p>
<p><span style="color:red"> <strong><em>Requirements</em></strong> </span></p>
<p>The one-way ANONA model has the following requirements or assumptions.</p>
<ul>
<li><p><em>Each sub-population formed by the category of the factor is normally distributed.</em> In the two-sample <span class="math inline">\(z\)</span> or <span class="math inline">\(t\)</span> test, we also have such assumption that the two samples are drawn independently from two normally distributed populations or at least both sample sizes are sufficiently large.</p></li>
<li><p><em>The populations have the same variance <span class="math inline">\(\sigma^2\)</span>.</em> ANOVA does not ridiculously assume all the population variances are known. Instead, the model admits the variances are unknown, but assumes they are all equal. Also sounds ridiculous? Anyway, it is what it is, and this is one of the limitations of ANOVA, although equality of variances is a pretty loose requirement. It is also possible to transform our data, so that the transformed samples have similar magnitude of variance. Does this assumption remind you of something? The two-sample pooled <span class="math inline">\(t\)</span>-test has the equality of variance assumption too. In this point of view, one-way ANOVA is a generalization of the two-sample pooled <span class="math inline">\(t\)</span>-test. The next two requirements will be not surprising at all because they are also requirements of the two-sample pooled <span class="math inline">\(t\)</span>-test.</p></li>
<li><p><em>The samples are random samples.</em> Without mentioned explicitly, the inference methods and statistical models introduced in the book are based on random samples.</p></li>
<li><p><em>The samples are independent of each other.</em> They are not matched or paired in any way.</p></li>
</ul>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Data and Math Notation for ANOVA
</div>
</div>
<div class="callout-body-container callout-body">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./images/img-model/anova_data.png" class="img-fluid figure-img" style="width:100.0%"></p>
<figcaption>Source: Table 8.5 of SMD.</figcaption></figure>
</div>
</div>
</div>
<ul>
<li><p><span class="math inline">\(y_{ij}\)</span>: <span class="math inline">\(j\)</span>-th observation from population <span class="math inline">\(i\)</span>. <span class="math inline">\(\color{blue}{(y_{24}:\text{ 4-th observation from population 2})}\)</span></p></li>
<li><p><span class="math inline">\(n_i\)</span>: number of values in the <span class="math inline">\(i\)</span>-th group/sample. (<span class="math inline">\(i = 1, \dots, k = 5\)</span>) <span class="math inline">\(\color{blue}{\small (n_1 = n_2 = \dots = n_5 = 4)}\)</span></p></li>
<li><p><span class="math inline">\(\bar{y}_{i\cdot}\)</span>: the average of values in the <span class="math inline">\(i\)</span>-th sample, <span class="math inline">\(\bar{y}_{i\cdot} = \frac{\sum_{j=1}^{n_i}y_{ij}}{n_i}.\)</span></p></li>
<li><p><span class="math inline">\(N\)</span>: total number of values in all samples combined, <span class="math inline">\(\small N = n_1 + \dots + n_k = \sum_{i=1}^kn_i\)</span>. <span class="math inline">\(\color{blue}{\small (N = 4 + \dots + 4 = 20)}\)</span></p></li>
<li><p><span class="math inline">\(\bar{y}_{\cdot\cdot}\)</span>: the <em>grand</em> sample mean that is the average of all sample values combined, <span class="math inline">\(\bar{y}_{\cdot\cdot} = \frac{\sum_{i=1}^{k}\sum_{j=1}^{n_i}y_{ij}}{N} = \frac{\sum_{i=1}^{k}n_i\bar{y}_{i\cdot}}{n_1 + \dots + n_t}\)</span></p></li>
</ul>
<p>Mathematically, suppose there are <span class="math inline">\(k\)</span> populations/samples, and for group <span class="math inline">\(i =1, \dots, k\)</span>, <span class="math inline">\(n\)</span> observations are drawn. Then</p>
<p><span class="math display">\[y_{ij} \stackrel{iid}{\sim} N(\mu_i, \sigma^2), ~~ j = 1, 2, \dots, n.\]</span></p>
<p>Our goal is to test whether or not <span class="math inline">\(\mu_1 = \mu_2 = \cdots = \mu_k.\)</span> If we do not reject <span class="math inline">\(H_0: \mu_1 = \mu_2 = \cdots = \mu_k,\)</span> then all samples are viewed as samples from a common normal distribution, i.e., <span class="math inline">\(N(\mu_i, \sigma^2)\)</span> and <span class="math inline">\(\mu = \mu_1 = \mu_2 = \cdots = \mu_k\)</span>.</p>
<p><span class="math display">\[y_{ij} \stackrel{iid}{\sim} N(\mu, \sigma^2), ~~ j = 1, 2, \dots, n.\]</span></p>
</div>
</div>
<p><span style="color:red"> <strong><em>Rationale</em></strong> </span></p>
<p>The section is quite important because we discuss in detail why we use variance size to test whether or not population means are equal.</p>
<p>Suppose we have two data sets Data 1 and Data 2, and both have three groups to be compared. Interestingly, Data 1 and Data 2 have the same group sample means <span class="math inline">\(\bar{y}_1\)</span>, <span class="math inline">\(\bar{y}_2\)</span> and <span class="math inline">\(\bar{y}_3\)</span> denoted as red dots in <a href="#fig-boxplots-var" class="quarto-xref">Figure&nbsp;<span>23.1</span></a>. However, they differ with regards to the variance within each group. Data 1 has small variance within samples, while Data 2 has large variance within samples. Within groups, the data points in Data 1 are quite tight and close each other, and therefore they are all close to their sample mean. On the contrary, the data points in Data 2 are quite distant each other, even they are in the same group. Such distribution pattern tells us that the populations from which the samples of Data 1 are drawn have small variance <span class="math inline">\(\sigma^2\)</span>.</p>
<p>Before we go into more details, letâ€™s see if you have a great intuition.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
For which data do you feel more confident in saying the population means <span class="math inline">\(\mu_1\)</span>, <span class="math inline">\(\mu_2\)</span> and <span class="math inline">\(\mu_3\)</span> are not all the same?
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-boxplots-var" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-boxplots-var-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="model-anova_files/figure-html/fig-boxplots-var-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxplots-var-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;23.1: Boxplots illustrating the variance within samples.
</figcaption></figure>
</div>
</div>
</div>
<!-- :::{.callout-note icon=false} -->
<!-- ## For which data do you feel more confident in saying the population means $\mu_1$, $\mu_2$ and $\mu_3$ are not all the same? -->
<!-- ::: -->
<p>If your answer is Data 1, congratulations you are correct!</p>
<p>The difference in sample means in Data 1 is more likely due to the true difference in population means (<span class="math inline">\(\mu_1, \mu_2, \mu_3\)</span> not all the same). Because of the small variation within groups, in Data 1 a value drawn from group 1 is very unlikely to be drawn from another group because with the normality assumption, the chance to be drawn from another group is very tiny. <a href="#fig-normal-var" class="quarto-xref">Figure&nbsp;<span>23.2</span></a> clearly illustrates this idea. The samples of Data 1 are so well-separated that we are more confident to say they are drawn from three well-separated populations that are not overlapped each other, and have distinct population means <span class="math inline">\(\mu_1, \mu_2\)</span>, and <span class="math inline">\(\mu_3\)</span>.</p>
<p>If the variance within groups is large, as shown at the bottom of <a href="#fig-normal-var" class="quarto-xref">Figure&nbsp;<span>23.2</span></a>, all three samples are mixed up together, as if they are all from the common population, even though they are in fact are from three distinct populations <span class="math inline">\(N(\mu_1, \sigma^2), N(\mu_2, \sigma^2), N(\mu_3, \sigma^2)\)</span> and <span class="math inline">\(\mu_1 \ne \mu_2 \ne \mu_3\)</span>. Note that the three populations still have their own distinct population mean which is actually identical to the mean with small variance, but it is hard for us to learn this fact from their mixed random samples. Because the three samples are indistinguishable, we donâ€™t have strong evidence to conclude that their corresponding population has its own population mean, and tend to conclude that the three samples are from a common population <span class="math inline">\(N(\mu, \sigma^2)\)</span>.</p>
<!-- Therefore, the blue points can only be the draws from blue normal distribution,  -->
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-normal-var" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-normal-var-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="model-anova_files/figure-html/fig-normal-var-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-normal-var-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;23.2: Populations with small and large variance within samples.
</figcaption></figure>
</div>
</div>
</div>
<p>The three samples in <a href="#fig-normal-one" class="quarto-xref">Figure&nbsp;<span>23.3</span></a> are from a common population <span class="math inline">\(N(\mu, \sigma^2)\)</span>. The samples look pretty similar to the samples with large variance in <a href="#fig-normal-var" class="quarto-xref">Figure&nbsp;<span>23.2</span></a>. In other words, either one common population or three populations with large variance can produce quite similar samples. With the samples only, we cannot tell which data generating mechanism is the true one generating such data.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-normal-one" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-normal-one-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="model-anova_files/figure-html/fig-normal-one-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-normal-one-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;23.3: Three samples drawn from a common normal population.
</figcaption></figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>Always keep in mind that all we have are samples, and we never know the true means <span class="math inline">\(\mu_1\)</span>, <span class="math inline">\(\mu_2\)</span>, and <span class="math inline">\(\mu_3\)</span>. In the figures, we assume we know the true populations, and see what the samples look like. Statistical inference is trickier. We want to have a decision rule, so that we know how much the samples are well separated is enough to say they are from three different populations.</p>
</div>
</div>
<!-- variation between samples is measured by the pairwise distance among the sample means. -->
<!-- variation within samples is measured by the how far away the data points away from each other in each sample group. -->
<hr>
<p><span style="color:blue"> <strong>Variation Between Samples &amp; Variation Within Samples</strong> </span></p>
<p>There are two types of variation we need to consider in order to determine whether population means are identical. They are <strong>variation between samples</strong> and <strong>variation within samples</strong>.</p>
<p>We have discussed the variation within samples or variance within groups, which measures the variability of data points in each group. This is actually the sample point estimate of the population variance <span class="math inline">\(\sigma^2\)</span> because the data points in the <span class="math inline">\(i\)</span>-th group are assumed from the <span class="math inline">\(i\)</span>-th population <span class="math inline">\(N(\mu_i, \sigma^2).\)</span> There are <span class="math inline">\(k\)</span> sample variance, one for each group. Later, we will learn how to combine them to get one single variance within samples as an estimate of <span class="math inline">\(\sigma^2\)</span>.</p>
<p>Variation between samples, on the other hand, measures variability of sample means. <em>The farther away from each other the sample means are, the larger variation between samples</em>. In our Data 1 and Data 2 example, their variation between samples are very close because the relative location of their sample means are basically the same. <a href="#fig-boxplot-bw" class="quarto-xref">Figure&nbsp;<span>23.4</span></a> illustrating the variance between samples. Data 3 and 4 have the same variance within samples, but Data 3 have small variation between samples and Data 4 have large variation between samples. Clearly, the sample means in Data 4 are farther away from each other, comparing to Data 3.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-boxplot-bw" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-boxplot-bw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="model-anova_files/figure-html/fig-boxplot-bw-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxplot-bw-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;23.4: Boxplots illustrating the variance between samples.
</figcaption></figure>
</div>
</div>
</div>
<p>Let me ask you the same question for Data 3 and 4.</p>
<div class="callout callout-style-default callout-note no-icon callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-title-container flex-fill">
For which data do you feel more confident in saying the population means <span class="math inline">\(\mu_1\)</span>, <span class="math inline">\(\mu_2\)</span> and <span class="math inline">\(\mu_3\)</span> are not all the same?
</div>
</div>
<div class="callout-body-container callout-body">

</div>
</div>
<p>Your answer should be Data 4. When the sample means <span class="math inline">\(\bar{y}_1\)</span>, <span class="math inline">\(\bar{y}_2\)</span> and <span class="math inline">\(\bar{y}_3\)</span> are far away from each other, and they serve as the unbiased point estimate of <span class="math inline">\(\mu_1\)</span>, <span class="math inline">\(\mu_2\)</span> and <span class="math inline">\(\mu_3\)</span>, respectively, we tend to claim that <span class="math inline">\(\mu_1\)</span>, <span class="math inline">\(\mu_2\)</span> and <span class="math inline">\(\mu_3\)</span> are not identical.</p>
<p>We have an important finding. <em>Whether or not there is a difference in population means depends on the relative size of variation between samples and variation within samples</em>. When variability between samples is <em>large</em> <em>in comparison to</em> the variation within samples, like Data 1 and Data 4, we tend to conclude that the population means are not all the same. When variation between samples is <em>small</em> relatively to the variation within samples, like Data 2 and Data 3, itâ€™s hard to exclude the possibility that all samples comes from the same population.</p>
<!-- - Data 1: Variability between samples is *large* *in comparison to* the variation within samples. -->
<!-- - Data 2: Variation between samples is *small* relatively to the variation within samples. -->
<!-- - Data 3: Variability between samples is *small* *in comparison to* the variation within samples. -->
<!-- - Data 4: Variation between samples is *large* relatively to the variation within samples. -->
<!-- :::{.callout-note icon=false} -->
<!-- ## We are more confident concluding there is a difference in population means when variation **between** samples is *larger* than variation **within** samples. -->
<!-- ::: -->
<!-- # ```{r, out.width="55%", echo=FALSE, fig.align='center'} -->
<!-- # #| label: fig-var-within -->
<!-- # #| fig-cap: Illustration of small and large variance within samples -->
<!-- # knitr::include_graphics("./images/img-model/figure8-1.png") -->
<!-- # ``` -->
</section><section id="anova-procedures" class="level2" data-number="23.2"><h2 data-number="23.2" class="anchored" data-anchor-id="anova-procedures">
<span class="header-section-number">23.2</span> ANOVA Procedures</h2>
<p>ANOVA is usually done by providing the ANOVA table below.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./images/img-model/anova_table_k.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="818"></p>
</figure>
</div>
</div>
</div>
<p>In this section, we are going to learn the meaning of every cell in the table, and how to use the table to do the testing of equality of population means.</p>
<!-- We now introduce the ANOVA procedures for testing the equality of population means. -->
<p>The hypotheses is <span style="color:blue"> <span class="math display">\[\begin{align} &amp;H_0: \mu_1 = \mu_2 = \cdots = \mu_k\\  &amp;H_1: \text{Population means are not all equal} \end{align}\]</span> </span></p>
<p>Note that the alternative hypothesis is not <span class="math inline">\(H_1: \mu_1 \ne \mu_2 \ne \cdots \ne \mu_k\)</span>. This is just one scenario where <span class="math inline">\(H_0\)</span> is not satisfied. Any <span class="math inline">\(\mu_i \ne \mu_j , i \ne j\)</span> violates <span class="math inline">\(H_0\)</span>, and should be a possibility of <span class="math inline">\(H_1\)</span>.</p>
<!-- - We use $F$-test.  -->
<p>We learned that whether or not there is a difference in population means depends on the relative size of variation between samples and variation within samples. Statistician Ronald Fisher found a way to define a variable which is the ratio of variance between samples to variance within samples, and the variable follows the <span class="math inline">\(F\)</span> distribution: <span class="math display">\[\frac{\text{variance between samples}}{\text{variance within samples}} \sim F_{df_B,\, df_W}\]</span> The degrees of freedom <span class="math inline">\(df_B\)</span> is paired with variance between samples and <span class="math inline">\(df_W\)</span> is for variance within samples. Be careful the order matters.</p>
<p>ANONA uses F test. If the variance <em>between</em> samples is much larger than the variance <em>within</em> samples, then the <span class="math inline">\(F\)</span> test statistic <span class="math inline">\(F_{test}\)</span> will be much greater than 1, which may be over the <span class="math inline">\(F\)</span> critical value, and <span class="math inline">\(H_0\)</span> is rejected.</p>
<p>The key question is how variance between samples and variance within samples are defined so that the ratio is <span class="math inline">\(F\)</span> distributed.</p>
<!-- :::{.callout-note icon=false} -->
<!-- ## Key -->
<!-- - Define variance between samples and variance within samples so that the ratio is $F$ distributed. -->
<!-- ::: -->
<!-- ------------------------------------------------------------------ -->
<p><span style="color:blue"> <strong>Variance Within Samples</strong> </span></p>
<p>One-way ANOVA is a generalization of the two-sample pooled <span class="math inline">\(t\)</span>-test. In the two-sample pooled <span class="math inline">\(t\)</span>-test with equal variance <span class="math inline">\(\sigma^2\)</span>, we have the pooled sample variance <span class="math display">\[s_p^2 = \frac{(n_1-1)s_1^2 + (n_2-1)s_2^2}{n_1 + n_2 - 2}\]</span></p>
<!-- :::{.callout-note icon=false} -->
<!-- ## How about the pooled sample variance for $k$ samples? -->
<!-- ::: -->
<p>How about the pooled sample variance for <span class="math inline">\(k\)</span> samples? ANOVA assumes the populations have the <strong>same variance</strong> such that <span class="math inline">\(\sigma_1^2 = \sigma_2^2 = \cdots = \sigma_k^2 = \sigma^2\)</span>. With the same logic, we can have the pooled sample variance from <span class="math inline">\(k\)</span> samples <span class="math display">\[\boxed{s_W^2 = \frac{(n_1-1)s_1^2 + (n_2-1)s_2^2 + \cdots + (n_k-1)s_k^2}{n_1 + n_2 + \cdots + n_k - k}}\]</span> where <span class="math inline">\(s_i^2\)</span>, <span class="math inline">\(i = 1, \dots ,k\)</span>, is the sample variance of <span class="math inline">\(i\)</span>-th group. <span class="math inline">\(s_W^2\)</span> represents a <em>combined</em> estimate of the common variance <span class="math inline">\(\sigma^2\)</span>. It measures variability of the observations within the <span class="math inline">\(k\)</span> populations. Note that each <span class="math inline">\(s_i^2\)</span> measures the variability within the <span class="math inline">\(i\)</span>-th sample. So this pooled estimate is the variance within samples.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./images/img-model/var_within_group.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" width="864"></p>
</figure>
</div>
</div>
</div>
<!-- ----------------------------------------------------------------- -->
<p><span style="color:blue"> <strong>Variance Between Samples</strong> </span></p>
<p>The variance between samples measures variability <em>among</em> sample means for the <span class="math inline">\(k\)</span> groups, which is defined as <span class="math display">\[\boxed{s^2_{B} = \frac{\sum_{i=1}^k n_i (\bar{y}_{i\cdot} - \bar{y}_{\cdot\cdot})^2}{k-1}}\]</span> where</p>
<ul>
<li>
<span class="math inline">\(\bar{y}_{i\cdot}\)</span> is the <span class="math inline">\(i\)</span>-th sample mean.</li>
<li>
<span class="math inline">\(\bar{y}_{\cdot\cdot}\)</span> is the <em>grand</em> sample mean with all data points in all groups combined.</li>
<li>
<span class="math inline">\(n_i\)</span> is the sample size of the <span class="math inline">\(i\)</span>-th sample.</li>
</ul>
<p>The variance between samples measures the magnitude of how large is the deviation from group means to the overall grand mean. When <span class="math inline">\(\bar{y}_{i\cdot}\)</span>s are away from each other, <span class="math inline">\((\bar{y}_{i\cdot} - \bar{y}_{\cdot\cdot})^2\)</span> will be large, so is <span class="math inline">\(s^2_{B}\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./images/img-model/var_between_group.jpg" class="img-fluid quarto-figure quarto-figure-center figure-img" width="737"></p>
</figure>
</div>
</div>
</div>
<p>In fact, not only <span class="math inline">\(s^2_{W}\)</span> estimates <span class="math inline">\(\sigma^2\)</span>, <span class="math inline">\(s^2_{B}\)</span> is also an estimate of <span class="math inline">\(\sigma^2\)</span>. If <span class="math inline">\(H_0\)</span> is true <span class="math inline">\((\mu_1 = \cdots = \mu_k = \mu)\)</span>, any variation in the sample means is due to chance and randomness, so it shouldnâ€™t be too large. <span class="math inline">\(\bar{y}_{1\cdot}, \cdots, \bar{y}_{k\cdot}\)</span> should be close each other and should be close to <span class="math inline">\(\bar{y}_{\cdot \cdot}\)</span>. This leads to a small <span class="math inline">\(s^2_{B}\)</span> and small ratio <span class="math inline">\(s^2_{B}/s^2_{W}\)</span> that is our <span class="math inline">\(F\)</span> test statistic. Thatâ€™s why when <span class="math inline">\(\mu_1 = \cdots = \mu_k = \mu\)</span>, we have small <span class="math inline">\(F\)</span> test statistic and tend to not reject <span class="math inline">\(H_0\)</span>.</p>
<!-- ----------------------------------------------------------------- -->
<p><span style="color:blue"> <strong>ANOVA Table: Sum of Squares</strong> </span></p>
<p>In the ANOVA table, there is a column Sum of Squares. There are three types of sum of squares. Letâ€™s learn what they are.</p>
<p><strong>Total Sum of Squares (SST)</strong> measures the total variation around <span class="math inline">\(\bar{y}_{\cdot\cdot}\)</span> in all of the sample data combined (ignoring the groups), which is defined as: <span class="math display">\[\color{blue}{SST = \sum_{j=1}^{n_i}\sum_{i=1}^{k} \left(y_{ij} - \bar{y}_{\cdot\cdot}\right)^2}\]</span> where <span class="math inline">\(y_{ij}\)</span> is the <span class="math inline">\(j\)</span>-th data point in the <span class="math inline">\(i\)</span>-th group.</p>
<p><strong>Sum of Squares Between Samples (SSB)</strong> measures the variation <em>between</em> sample means: <span class="math display">\[\color{blue}{SSB = \sum_{i=1}^{k}n_i \left(\bar{y}_{i\cdot} - \bar{y}_{\cdot\cdot}\right)^2}\]</span></p>
<p><strong>Sum of Squares Within Samples (SSW)</strong> measures the variation of any value, <span class="math inline">\(y_{ij}\)</span>, about its sample mean, <span class="math inline">\(\bar{y}_{i\cdot}\)</span>: <span class="math display">\[\color{blue}{SSW = \sum_{i=1}^{k} \sum_{j=1}^{n_i} \left(y_{ij} - \bar{y}_{i\cdot}\right)^2 = \sum_{i=1}^{k} (n_i - 1)s_i^2}\]</span></p>
<p><span style="color:red"> <strong><em>Sum of Squares Identity</em></strong> </span></p>
<p>The three sum of squares are related by the identity <span class="math display">\[SST = SSB + SSW.\]</span></p>
<p>Intuitively, for data points <span class="math inline">\(y_{ij}\)</span>, their squared distance from the grand sample mean <span class="math inline">\(\bar{y}_{\cdot\cdot}\)</span> can be decomposed into two parts: (1) the squared distance between their own group sample mean and the grand sample mean, and (2) the their squared distance from their own group sample mean.</p>
<p>Note that the sum of squares statistics have associated degrees of freedom. More interestingly, the three degrees of freedom also form an identity. So</p>
<p><span class="math display">\[df_{T} = df_{B} + df_{W}\]</span> where</p>
<ul>
<li>
<span class="math inline">\(df_{T} = N-1\)</span> is the degrees of freedom of <span class="math inline">\(SST\)</span>
</li>
<li>
<span class="math inline">\(df_{B} = k - 1\)</span> is the degrees of freedom of <span class="math inline">\(SSB\)</span>
</li>
<li>
<span class="math inline">\(df_{W} = N - k\)</span> is the degrees of freedom of <span class="math inline">\(SSW\)</span>.</li>
</ul>
<p>When a sum of squares divided by its degrees of freedom, we get its <strong>mean square (MS)</strong>, i.e., <span class="math display">\[\text{mean square} = \dfrac{\text{sum of squares}}{\text{degrees of freedom}}.\]</span> We are particularly interested in the <strong>mean square between</strong> (<strong>MSB</strong>) and <strong>mean square within</strong> (<strong>MSW</strong>):</p>
<ul>
<li><span class="math inline">\(MSB = \frac{SSB}{k-1} = s^2_{B}\)</span></li>
<li><span class="math inline">\(MSW = \frac{SSW}{N-k} = s^2_{W}\)</span></li>
</ul>
<!-- $\begin{align} &df_{T} = df_{B} + df_{W} \\&n - 1 = (k-1) + (n - k) \end{align}$ --><!-- - $\text{Mean Square (MS)} = \frac{\text{sum of squares}}{\text{degrees of freedom}}$ --><!-- - $MSB = \frac{SSB}{k-1} = s^2_{B}$ --><!-- - $MSW = \frac{SSW}{N-k} = s^2_{W}$ --><p>Please check the formula of <span class="math inline">\(SSB\)</span> and <span class="math inline">\(SSW\)</span>. You will find that <span class="math inline">\(MSB\)</span> is our variance between samples and <span class="math inline">\(MSW\)</span> is our variance within samples! So our <span class="math inline">\(F\)</span> test statistic is <span class="math display">\[F_{test} = \frac{MSB}{MSW}.\]</span></p>
<p>Under <span class="math inline">\(H_0\)</span>, <span class="math inline">\(s^2_{B}/s_W^2\)</span> is a statistic from <span class="math inline">\(F_{k-1, \, N-k}\)</span> distribution. The first degrees of freedom is <span class="math inline">\(df_{B} = k - 1\)</span>, and the second is <span class="math inline">\(df_{W} = N - k\)</span>. They cannot be switched.</p>
<p>We reject <span class="math inline">\(H_0\)</span> in favor of <span class="math inline">\(H_1\)</span> if <span class="math inline">\(F_{test} &gt; F_{\alpha, \, k - 1,\, N-k}\)</span>, or <span class="math inline">\(p\)</span>-value <span class="math inline">\(P(F_{k - 1,\, N-k} &gt; F_{test}) &lt; \alpha\)</span> for some significance level <span class="math inline">\(\alpha\)</span>.</p>
<p><span style="color:red"> <strong><em>ANOVA Table</em></strong> </span></p>
<p>We are done! Weâ€™ve talked about every cell in the ANOVA table, and we can use the table to do the test and make a conclusion about the equality of population means.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./images/img-model/anova_table_k.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="818"></p>
</figure>
</div>
</div>
</div>
</section><section id="anova-example" class="level2" data-number="23.3"><h2 data-number="23.3" class="anchored" data-anchor-id="anova-example">
<span class="header-section-number">23.3</span> ANOVA Example</h2>
<p>We hypothesize that a nutrient called â€œisoflavonesâ€ varies among three types of food: (1) cereals and snacks, (2) energy bars and (3) veggie burgers.</p>
<div class="columns">
<div class="column" style="width:32%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./images/img-model/cereal.jpeg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:2%;">

</div><div class="column" style="width:32%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./images/img-model/energy_bar.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:2%;">

</div><div class="column" style="width:32%;">
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./images/img-model/veggie_burger.jpeg" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div>
</div>
<p>A sample of 5 is taken from each type of food and the amount of isoflavones is measured. Is there a sufficient evidence to conclude that the mean isoflavone levels vary among these food items at <span class="math inline">\(\alpha = 0.05\)</span>?</p>
<hr>
<p>We are going to learn to generate a ANOVA table using R.</p>
<p><span style="color:blue"> <strong>Data</strong> </span></p>
<p>In order to use the R built-in function for ANOVA, we get to make sure the data matrix is in the right format. The original data set we get may be something like object <code>data</code> below, where each column represents the five isoflavones measurements of a food type. It is not a <em>â€œwrongâ€</em> data format, but just not what we need for doing ANOVA. The data frame <code>data_anova</code> is the data format needed for ANOVA. There are two columns, our response variable isoflavones measurement labelled <code>y</code>, and the factor or categorical variable that may affect the response value, which is food type labelled <code>food</code>. With this format, there will be totally <span class="math inline">\(N=15\)</span> observations and rows. Please transform any data into this kind of data format before you do ANOVA.</p>
<!-- - We prefer a data format like the one shown on the right. -->
<div class="columns">
<div class="column" style="width:49%;">
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   1  2  3
1  3 19 25
2 17 10 15
3 12  9 12
4 10  7  9
5  4  5  8</code></pre>
</div>
</div>
<!-- :::{.callout-note icon=false} -->
<!-- ## So tell me what is the value of $y_{23}$! -->
<!-- ::: -->
</div><div class="column" style="width:2%;">

</div><div class="column" style="width:49%;">
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_anova</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    y    food
1   3 cereals
2  17 cereals
3  12 cereals
4  10 cereals
5   4 cereals
6  19  energy
7  10  energy
8   9  energy
9   7  energy
10  5  energy
11 25  veggie
12 15  veggie
13 12  veggie
14  9  veggie
15  8  veggie</code></pre>
</div>
</div>
</div>
</div>
<p>The boxplot kind of gives us the isoflavones distribution by food type. It is hard to say whether the food type affects isoflavone level or not, and we need ANOVA to help us make the conclusion.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-boxplot-isoflavone" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-boxplot-isoflavone-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="model-anova_files/figure-html/fig-boxplot-isoflavone-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-boxplot-isoflavone-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;23.5: Boxplot of the Isoflavone Content in 3 Types of Food
</figcaption></figure>
</div>
</div>
</div>
<hr>
<p><span style="color:blue"> <strong>Test Assumptions</strong> </span></p>
<p>Before implementing any statistical method, always check its method assumptions.</p>
<p>ANOVA requires</p>
<ul>
<li><span class="math inline">\(\sigma_1 = \sigma_2 = \sigma_3\)</span></li>
<li>Data are generated from a normal distribution for each type of food.</li>
</ul>
<p>Well we did not learn to test the equality of more than two population variances, but believe me I did the test, and the three variances are not significantly different from each other. <a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> Even the the variances are not all equal, the ANOVA performance will not be worse much. Equality of variances is not a strict requirement. George Box of UW-Madison showed that as long as the sample sizes are (nearly) equal, the largest variance can be up to 9 times the smallest one and the result of ANOVA will continue to be reliable. A general rule of thumb for equal variances is to compare the smallest and largest sample standard deviations. This is much like the rule of thumb for equal variances for the test for independent means. If the ratio of these two sample standard deviations falls within 0.5 to 2, then it may be that the assumption is not violated.</p>
<p>To check the normality, we can check their QQ plots. <a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> <a href="#fig-qqplots" class="quarto-xref">Figure&nbsp;<span>23.6</span></a> shows that there is no obvious non-normal pattern although two data points are outside the blue 95% confidence region. The normality is not very restrictive as well. As long as the distribution is not very skewed, ANOVA works pretty well.</p>
<p>We say the ANOVA <span class="math inline">\(F\)</span> test is <strong>robust</strong> to the violation of the two assumptions.</p>
<!-- https://cran.r-project.org/web/packages/onewaytests/index.html -->
<!-- Shapiro-Wilkâ€™s method is widely recommended for normality test and it provides better power than K-S. It is based on the correlation between the data and the corresponding normal scores. -->
<!-- Empirical testing has found[5] that the Andersonâ€“Darling test is not quite as good as the Shapiroâ€“Wilk test, but is better than other tests -->
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-qqplots" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-qqplots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="model-anova_files/figure-html/fig-qqplots-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-qqplots-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;23.6: QQ plots for each type of food
</figcaption></figure>
</div>
</div>
</div>
<p><span style="color:blue"> <strong>ANOVA Testing</strong> </span></p>
<p>We are interested in the following test:</p>
<p><span style="color:blue"> <span class="math inline">\(\begin{align}&amp;H_0: \mu_1 = \mu_2 = \mu_3\\&amp;H_1: \mu_is \text{ not all equal} \end{align}\)</span> </span></p>
<p>where <span class="math inline">\(\mu_1\)</span>, <span class="math inline">\(\mu_2\)</span>, <span class="math inline">\(\mu_3\)</span> stand for the population mean level of isoflavones of food cereals and snacks, energy bars, and veggie burgers respectively.</p>
<p>We could follow the regular six-step testing procedure, but generating the ANOVA table is more straightforward.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./images/img-model/anova_table_k.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="818"></p>
</figure>
</div>
</div>
</div>
<p>In R, we can do all the calculations and generate an ANOVA table using just one line of code. We first use the popular function <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> to implement ANOVA. The first argument is <code>formula</code> that has the form <code>response ~ factor</code> where <code>response</code> is the numeric response vector, and <code>factor</code> is the categorical factor vector. In our data <code>data_anova</code>, <code>y</code> is our response, and <code>food</code> is our factor. Note that if we just write <code>y</code> and <code>food</code> in the formula, R will render an error because R does not recognize <code>y</code> and <code>food</code> because they are not an R object but a column name of data <code>data_anova</code>. Therefore, we need to tell R where <code>y</code> and <code>food</code> are from by specifying the data set they are referred. If you want to specify the data name, you can get access to the response and factor vector by extracting them using <code>data_anova$y</code> and <code>data_anova$food</code>.</p>
<p>The word <code>lm</code> stands for <strong>linear model</strong>, and ANOVA is a linear model. If you just run <code>lm(formula = data_anova$y ~ data_anova$food)</code>, it will show the linear model output related to ANOVA. We donâ€™t need it at this moment, and we will discuss more about linear model in Regression <a href="model-reg.html" class="quarto-xref"><span>Chapter 26</span></a>.</p>
<p>To obtain the ANOVA table, we apply the function <code><a href="https://rdrr.io/r/stats/anova.html">anova()</a></code> to the <code>lm</code> object. In the output, <code>food</code> is the source of variation between samples. <code>Residuals</code> is for the source of variation within samples. <code>F value</code> is the <span class="math inline">\(F\)</span> test statistic value, not the critical value. <code>Pr(&gt;F)</code> is the <span class="math inline">\(p\)</span>-value. Since <span class="math inline">\(p\)</span>-value &gt; 0.05, we do not reject <span class="math inline">\(H_0\)</span>. The evidence is not sufficient to reject the equality of population means.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">y</span> <span class="op">~</span> <span class="va">food</span>, data <span class="op">=</span> <span class="va">data_anova</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: y
          Df Sum Sq Mean Sq F value Pr(&gt;F)
food       2   60.4  30.200  0.8282 0.4603
Residuals 12  437.6  36.467               </code></pre>
</div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">data_anova</span><span class="op">$</span><span class="va">y</span> <span class="op">~</span> <span class="va">data_anova</span><span class="op">$</span><span class="va">food</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: data_anova$y
                Df Sum Sq Mean Sq F value Pr(&gt;F)
data_anova$food  2   60.4  30.200  0.8282 0.4603
Residuals       12  437.6  36.467               </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>There is another way to generate the ANOVA table in R. We use <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> and <code><a href="https://rdrr.io/r/stats/aov.html">aov()</a></code> functions.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/aov.html">aov</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">food</span>, data <span class="op">=</span> <span class="va">data_anova</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>            Df Sum Sq Mean Sq F value Pr(&gt;F)
food         2   60.4   30.20   0.828   0.46
Residuals   12  437.6   36.47               </code></pre>
</div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># oneway.test(y ~ food, data = data_anova, var.equal = TRUE)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</section><section id="unequal-variances" class="level2" data-number="23.4"><h2 data-number="23.4" class="anchored" data-anchor-id="unequal-variances">
<span class="header-section-number">23.4</span> Unequal Variances</h2>
<p>The assumption of normality and equality of variances are both loose requirements. George Box of UW-Madison showed that as long as the sample sizes are (nearly) equal, the largest variance can be up to 9 times the smallest one and the result of ANOVA will continue to be reliable.</p>
<p>If population variances differ by large amount, we can <strong>transform the data</strong>. If the original variable is <span class="math inline">\(y\)</span>, and the variances associated with <span class="math inline">\(y\)</span> across the treatments are not equal (heterogeneous), it may be necessary to work with a new variable such <span class="math inline">\(\sqrt{y}\)</span>, <span class="math inline">\(\log y\)</span>, or some other transformed variable.</p>
<ul>
<li><p><span style="color:blue"> If <span class="math inline">\(\sigma^2 \propto \mu\)</span>, use <span class="math inline">\(Y_T = \sqrt{Y}\)</span> or <span class="math inline">\(\sqrt{Y+0.375}\)</span>. </span></p></li>
<li><p><span style="color:blue"> If <span class="math inline">\(\sigma^2 \propto \mu^2\)</span>, use <span class="math inline">\(Y_T = \log{(Y)}\)</span> or <span class="math inline">\(\log(Y+1)\)</span>. </span></p></li>
</ul>
<!-- ## Heterogeneous Variances on Original $y$ Scale --><p>The following example demonstrates how data transformation can significantly equalize variances across groups. In the original data <span class="math inline">\(y\)</span>, variance increases with the treatment type, which violates the assumption of homogeneity of variance necessary for performing ANOVA. Directly applying ANOVA to <span class="math inline">\(y\)</span> may result in unconvincing outcomes. However, by transforming the data from <span class="math inline">\(y\)</span> to <span class="math inline">\(\sqrt{y}\)</span>, the variances across the three groups become much more similar, thereby satisfying the homogeneity of variance assumption and making the ANOVA results more reliable.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="model-anova_files/figure-html/unnamed-chunk-25-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1248"></p>
</figure>
</div>
</div>
</div>
<!-- ## Square Root Transformation ($y \rightarrow \sqrt{y}$) -->
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="model-anova_files/figure-html/unnamed-chunk-26-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1248"></p>
</figure>
</div>
</div>
</div>
<section id="example-of-unequal-variances-example-8.4-smd" class="level3" data-number="23.4.1"><h3 data-number="23.4.1" class="anchored" data-anchor-id="example-of-unequal-variances-example-8.4-smd">
<span class="header-section-number">23.4.1</span> Example of Unequal Variances (Example 8.4 SMD)</h3>
<p>Biologists believe that Mississippi river causes the oxygen level to be depleted near the Gulf of Mexico. To test this hypothesis water samples are taken at different distances from the mouth of Mississippi river, and the amounts of dissolve oxygen (in ppm) are recorded.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./images/img-model/table8-16.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<!-- ![](./figures/table8-16.png){height=400px width=900px} -->
<!-- ## Example 8.4 Cont'd: Check the Data -->
<p>The origin data set <code>data_oxygen</code> is saved as</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>   1KM 5KM 10KM 20KM
1    1   4   20   37
2    5   8   26   30
3    2   2   24   26
4    1   3   11   24
5    2   8   28   41
6    2   5   20   25
7    4   6   19   36
8    3   4   19   31
9    0   3   21   31
10   2   3   24   33</code></pre>
</div>
</div>
<!-- ## Example 8.4 Cont'd: Test for Equal Variances -->
<p>First we learn that the homogeneity of variance assumption is violated by checking the boxplot.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/boxplot.html">boxplot</a></span><span class="op">(</span><span class="va">data_oxygen</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="model-anova_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>This is also verified by the Leveneâ€™s test using the function <code><a href="https://rdrr.io/pkg/car/man/leveneTest.html">car::leveneTest()</a></code>. The Leveneâ€™s test <span class="math inline">\(p\)</span>-value is 0.02, so we reject the <span class="math inline">\(H_0\)</span>: Equality of variance.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/car/man/leveneTest.html">leveneTest</a></span><span class="op">(</span><span class="va">oxygen</span> <span class="op">~</span> <span class="va">km</span>, data <span class="op">=</span> <span class="va">data_oxygen_tidy</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in leveneTest.default(y = y, group = group, ...): group coerced to
factor.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Levene's Test for Homogeneity of Variance (center = median)
      Df F value  Pr(&gt;F)  
group  3  3.7003 0.02029 *
      36                  
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>Note that here we use the data <code>data_oxygen_tidy</code>. As mentioned before, when doing analysis or fitting a statistical model, we prefer this <em>tidy data</em> that each column represents a variable, and each row stands for one observed value.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>   oxygen km
1       1  1
2       5  1
3       2  1
4       1  1
5       2  1
6       2  1
7       4  1
8       3  1
9       0  1
10      2  1
11      4  5
12      8  5
13      2  5
14      3  5
15      8  5
16      5  5
17      6  5
18      4  5
19      3  5
20      3  5
21     20 10
22     26 10
23     24 10
24     11 10
25     28 10
26     20 10
27     19 10
28     19 10
29     21 10
30     24 10
31     37 20
32     30 20
33     26 20
34     24 20
35     41 20
36     25 20
37     36 20
38     31 20
39     31 20
40     33 20</code></pre>
</div>
</div>
<p>To get some understanding of how we should transform our data to make the variances equal, letâ€™s calculate <span class="math inline">\(\frac{s_i^2}{\bar{y}_i}\)</span> for <span class="math inline">\(i = 1, 2, 3, 4\)</span>.</p>
<ul>
<li>
<span class="math inline">\(\frac{s_1^2}{\bar{y}_1} = 0.99\)</span>, <span class="math inline">\(\frac{s_2^2}{\bar{y}_2} = 0.97\)</span>, <span class="math inline">\(\frac{s_3^2}{\bar{y}_3} = 1.06\)</span>, <span class="math inline">\(\frac{s_4^2}{\bar{y}_4} = 0.97\)</span>
</li>
</ul>
<p>This tells us, nearly, the sample variance is proportional to the sample mean of the same group. So we can use the transformation <span class="math inline">\(Y_T = \sqrt{Y+0.375}\)</span>.</p>
<!-- ## Example 8.4 Cont'd: Transforming the Data -->
<!-- ![](./figures/table8-17.png){height=500px width=900px} -->
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="./images/img-model/table8-17.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Now, the variances for each group of the transformed data are much reasonably close.</p>
</section></section><section id="anova-mathematical-model" class="level2" data-number="23.5"><h2 data-number="23.5" class="anchored" data-anchor-id="anova-mathematical-model">
<span class="header-section-number">23.5</span> ANOVA Mathematical Model*</h2>
<p>To generalize the ANOVA, it is easier to think of one-factor ANOVA in the following way: <span class="math display">\[y_{ij} = \mu + \tau_i + \epsilon_{ij}, \quad j = 1, 2, \dots, n_i, \quad i = 1, 2, \dots, t\]</span></p>
<ul>
<li>
<span class="math inline">\(\mu\)</span> is the overall mean across all <span class="math inline">\(t\)</span> populations.</li>
<li>
<span class="math inline">\(\tau_i\)</span> is the effect due to <span class="math inline">\(i\)</span>-th treatment.</li>
<li>
<span class="math inline">\(\epsilon_{ij}\)</span> is the random deviation of <span class="math inline">\(y_{ij}\)</span> about the <span class="math inline">\(i\)</span>-th population mean <span class="math inline">\(\mu_i = \mu+ \tau_i\)</span>.</li>
<li>
<span class="math inline">\(\mu\)</span> and <span class="math inline">\(\tau_i\)</span> are unknown constants.</li>
<li>ANOVA is a <strong>linear</strong> model.</li>
</ul>
<p>The assumptions of ANOVA are</p>
<ul>
<li>
<span class="math inline">\(\epsilon_{ij}\)</span>s are independent and normally distributed with mean 0.</li>
<li>
<span class="math inline">\(Var(\epsilon_{ij}) = \sigma^2\)</span> (<span style="color:blue"> a constant value </span>)</li>
<li><span class="math inline">\(\epsilon_{ij} \sim N(0, \sigma^2)\)</span></li>
</ul>
<!-- ## ANOVA Model --><p><a href="#fig-anova-model" class="quarto-xref">Figure&nbsp;<span>23.7</span></a> illustrate the ANOVA model structure. There are 4 treatments, and the overall mean <span class="math inline">\(\mu = 75.5\)</span>. The 4 treatments are <span class="math inline">\(\tau_1 = -5.5\)</span>, <span class="math inline">\(\tau_2 = -17.5\)</span>, <span class="math inline">\(\tau_3= -14.5\)</span>, and <span class="math inline">\(\tau_4 = 8.5\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div id="fig-anova-model" class="quarto-figure quarto-figure-center quarto-float anchored" data-fig-align="center">
<figure class="quarto-float quarto-float-fig figure"><div aria-describedby="fig-anova-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="./images/img-model/anova_model.png" class="img-fluid quarto-figure quarto-figure-center figure-img" style="width:100.0%">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-anova-model-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;23.7: Illustration of ANOVA model structure. Figure 16.7 of Applied Linear Statistical Models, 5th ed.
</figcaption></figure>
</div>
</div>
</div>
<!-- ![](./figures/anova_model.png){height=300px width=500px} -->
<p>Let <span class="math inline">\(y_{13}\)</span> is the third measurement drawn from population 1, the its value can be decomposed into three parts: the overall mean, the adjustment due to being in the first treatment, and the random variation of the first population: <span class="math display">\[y_{13} = \mu + \tau_1 + \epsilon_{13}.\]</span></p>
<p>If <span class="math inline">\(y_{13} = 72\)</span>, then <span class="math display">\[y_{13} = \mu + \tau_1 + \epsilon_{13} \iff 72 = 75.5 + (-5.5) + 2.\]</span></p>
<!-- ### Hypothesis Testing of the ANOVA Model -->
<p>Again, our model is <span class="math inline">\(y_{ij} = \mu + \tau_i + \epsilon_{ij} = \mu_i + \epsilon_{ij}, \quad j = 1, 2, \dots, n_i, \quad i = 1, 2, \dots, t.\)</span></p>
<p>To test whether all samples come from the same population, we test whether all group means are equal:</p>
<p><span style="color:blue"> <span class="math inline">\(\begin{align}
  &amp;H_0: \mu_1 = \mu_2 = \cdots = \mu_t\\
  &amp;H_1: \text{Population means are not all equal}
  \end{align}\)</span> </span></p>
<p>This is equivalent to testing whether all treatment effects are zero, or there is no treatment/factor/group effect:</p>
<p><span style="color:blue"> <span class="math inline">\(\begin{align}
  &amp;H_0: \tau_i = 0 \text{ for all } i = 1, 2, \dots, t\\
  &amp;H_1: \tau_i \ne 0 \text{ for some } i
  \end{align}\)</span> </span></p>
<p>Test statistics and decision rule are same as before. <span class="math inline">\(s^2_{B} = MSB = \frac{SSB}{df_B}\)</span> and <span class="math inline">\(s^2_{W} = MSW = \frac{SSW}{df_W}\)</span>. Then the test statistic is <span class="math inline">\(F_{test} = \frac{s^2_{B}}{s_W^2}\)</span>. We reject <span class="math inline">\(H_0\)</span> if <span class="math inline">\(F_{test} &gt; F_{\alpha, \, df_{B},\, df_{W}}\)</span> or the <span class="math inline">\(p\)</span>-value <span class="math inline">\(P(F &gt; F_{test}) &lt; \alpha\)</span>.</p>
<section id="check-assumption-that-epsilon_ij-sim-n0-sigma2" class="level3" data-number="23.5.1"><h3 data-number="23.5.1" class="anchored" data-anchor-id="check-assumption-that-epsilon_ij-sim-n0-sigma2">
<span class="header-section-number">23.5.1</span> Check Assumption that <span class="math inline">\(\epsilon_{ij} \sim N(0, \sigma^2)\)</span>
</h3>
<p>We learn that <span class="math inline">\(y_{ij} = \mu + \tau_i + \epsilon_{ij} =  \mu_i + \epsilon_{ij}\)</span> where <span class="math inline">\(\mu_i = \mu + \tau_i\)</span>. As before, we need to check model assumptions. One assumption is <span class="math inline">\(\epsilon_{ij} \sim N(0, \sigma^2)\)</span>. Notice that it implies normality and homogeneity of variance assumptions.</p>
<p>For the model, we have <span class="math inline">\(\epsilon_{ij} = y_{ij} - \mu_i\)</span>. However, <span class="math inline">\(\mu_i\)</span> is unknown. We are not able to get the values of <span class="math inline">\(\epsilon_{ij}\)</span> and check whether they are normally distributed. One solution is to find its estimate. We first estimate the errors <span class="math inline">\(\epsilon_{ij}\)</span> by <span class="math inline">\(e_{ij}\)</span> called <strong>residuals</strong>: <span class="math display">\[e_{ij} = y_{ij} - \hat{\mu}_i =  y_{ij} - \bar{y}_{i\cdot},\]</span> where <span class="math inline">\(\hat{\mu}_i = \bar{y}_{i\cdot}\)</span>. We use a <em>hat</em> symbol <span class="math inline">\(\hat{}\)</span> to denote the estimated value for an unknown parameter, or the predicted value of the response. Here we donâ€™t know the group population means <span class="math inline">\(\mu_i\)</span>, but they can be estimated by their corresponding group sample means <span class="math inline">\(\bar{y}_{i\cdot}\)</span>.</p>
<!-- - Even when $n_i$s are small, we would have $n_T$ residuals, which provide a sufficient number of values to evaluate normality condition. -->
<ul>
<li><p>To test normal distribution of errors <span class="math inline">\(\epsilon_{ij}\)</span>, we look at the normal probability plot of <span class="math inline">\(e_{ij}\)</span>.</p></li>
<li>
<p>To test that the <span class="math inline">\(Var(\epsilon_{ij})\)</span> is constant of <span class="math inline">\(\sigma^2\)</span>, we look at the scatter plot of the residuals <span class="math inline">\(e_{ij}\)</span> and the predicted or <strong>fitted values</strong> <span class="math inline">\(\hat{y}_{ij}\)</span>, where <span class="math display">\[\hat{y}_{ij} = \hat{\mu}_i = \bar{y}_{i\cdot}.\]</span> <span class="math inline">\(\hat{y}_{ij}\)</span> is the fitted value of the <span class="math inline">\(j\)</span>th observation in the <span class="math inline">\(i\)</span>th group, which is an estimate of the observed data point <span class="math inline">\(y_{ij}\)</span>. The fitted value <span class="math inline">\(\hat{y}_{ij}\)</span> is the one produced from the model, and of course for the most of the time will not be the same as the observed value <span class="math inline">\(y_{ij}\)</span>. From ANOVA, <span class="math inline">\(\hat{y}_{ij} = \bar{y}_{i\cdot}\)</span>. That is, if we want to estimate any value drawn from the <span class="math inline">\(i\)</span>th population, ANOVA gives us a point estimate, the <span class="math inline">\(i\)</span>th group sample mean, to estimate any <span class="math inline">\(j\)</span>th observation from the <span class="math inline">\(i\)</span>th population.</p>
<p>The samples in the <span class="math inline">\(i\)</span>th population are not the same due to the variation of the normal distribution. However, when estimating each individual observation, ANOVA would not provide different values for different observations, but one single common value for all individual observations. The sampling variation cannot be captured by ANOVA, and using the mean value <span class="math inline">\(\bar{y}_{i\cdot}\)</span> as an estimate is the best ANOVA can do.</p>
</li>
</ul>
<!-- ## Going Back to Example 8.4 --><!-- - Biologists believe that Mississippi river causes the oxygen level to be depleted near the Gulf of Mexico. To test this hypothesis water samples are taken at different distances from the mouth of Mississippi river, and the amounts of dissolve oxygen (in ppm) are recorded. --><!-- ![](./figures/table8-16.png){height=400px width=900px} --><hr>
<p>Letâ€™s go back to the oxygen level example. The original data look like</p>
<!-- ## Fitted Values $\hat{y}_{ij} = \bar{y}_{i\cdot}$ {.tiny} -->
<!-- <div class="columns-2"> -->
<!-- # ```{r} -->
<!-- #  -->
<!-- # ``` -->
<!-- </br> -->
<!-- # ```{r} -->
<!-- # #| echo: !expr c(-1, -2) -->
<!-- # ## original data -->
<!-- # data_oxygen <- data_8_16[, 2:5] -->
<!-- # data_oxygen -->
<!-- # ``` -->
<!-- </div> -->
<p>To get the sample mean for each group, we can grab each column data, and calculate its average. For example, <span class="math inline">\(\bar{y}_{1\cdot} = 2.2\)</span>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html">colMeans</a></span><span class="op">(</span><span class="va">data_oxygen</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> 1KM  5KM 10KM 20KM 
 2.2  4.6 21.2 31.4 </code></pre>
</div>
</div>
<p>The fitted value can also be obtained from the fitted result by the fitted linear model from <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>. <code>oxygen_fit$fitted.values</code> gives us fitted values for all observations. Note that the first 10 observations all have the same fitted value 2.2 because they are all from the first group (1 km). Similarly for other groups.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co"># data_oxygen_tidy</span></span>
<span><span class="co">## fit a linear model to get fitted values and residuals</span></span>
<span><span class="va">oxygen_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">oxygen</span> <span class="op">~</span> <span class="va">km</span>, data <span class="op">=</span> <span class="va">data_oxygen_tidy</span><span class="op">)</span></span>
<span><span class="va">oxygen_fit</span><span class="op">$</span><span class="va">fitted.values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   1    2    3    4    5    6    7    8    9   10   11   12   13   14   15   16 
 2.2  2.2  2.2  2.2  2.2  2.2  2.2  2.2  2.2  2.2  4.6  4.6  4.6  4.6  4.6  4.6 
  17   18   19   20   21   22   23   24   25   26   27   28   29   30   31   32 
 4.6  4.6  4.6  4.6 21.2 21.2 21.2 21.2 21.2 21.2 21.2 21.2 21.2 21.2 31.4 31.4 
  33   34   35   36   37   38   39   40 
31.4 31.4 31.4 31.4 31.4 31.4 31.4 31.4 </code></pre>
</div>
</div>
<p>We can organize the fitted values, saving them as a data frame like the original data <code>data_oxygen</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">fitted_val</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="va">oxygen_fit</span><span class="op">$</span><span class="va">fitted.values</span>, <span class="fl">10</span>, <span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## use the same column name as the original data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">fitted_val</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span>, <span class="fl">10</span>, <span class="fl">20</span><span class="op">)</span>, <span class="st">"KM"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">## fitted value data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html">as.data.frame</a></span><span class="op">(</span><span class="va">fitted_val</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   1KM 5KM 10KM 20KM
1  2.2 4.6 21.2 31.4
2  2.2 4.6 21.2 31.4
3  2.2 4.6 21.2 31.4
4  2.2 4.6 21.2 31.4
5  2.2 4.6 21.2 31.4
6  2.2 4.6 21.2 31.4
7  2.2 4.6 21.2 31.4
8  2.2 4.6 21.2 31.4
9  2.2 4.6 21.2 31.4
10 2.2 4.6 21.2 31.4</code></pre>
</div>
</div>
<hr>
<p>Now letâ€™s check the residuals <span class="math inline">\(e_{ij} = y_{ij} - \bar{y}_{i\cdot}\)</span>. We can obtain the residuals using its definition</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_oxygen_tidy</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="va">oxygen_fit</span><span class="op">$</span><span class="va">fitted.values</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    1     2     3     4     5     6     7     8     9    10    11    12    13 
 -1.2   2.8  -0.2  -1.2  -0.2  -0.2   1.8   0.8  -2.2  -0.2  -0.6   3.4  -2.6 
   14    15    16    17    18    19    20    21    22    23    24    25    26 
 -1.6   3.4   0.4   1.4  -0.6  -1.6  -1.6  -1.2   4.8   2.8 -10.2   6.8  -1.2 
   27    28    29    30    31    32    33    34    35    36    37    38    39 
 -2.2  -2.2  -0.2   2.8   5.6  -1.4  -5.4  -7.4   9.6  -6.4   4.6  -0.4  -0.4 
   40 
  1.6 </code></pre>
</div>
</div>
<p>or we can simply grab them from the fitted result:</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">oxygen_fit</span><span class="op">$</span><span class="va">residuals</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    1     2     3     4     5     6     7     8     9    10    11    12    13 
 -1.2   2.8  -0.2  -1.2  -0.2  -0.2   1.8   0.8  -2.2  -0.2  -0.6   3.4  -2.6 
   14    15    16    17    18    19    20    21    22    23    24    25    26 
 -1.6   3.4   0.4   1.4  -0.6  -1.6  -1.6  -1.2   4.8   2.8 -10.2   6.8  -1.2 
   27    28    29    30    31    32    33    34    35    36    37    38    39 
 -2.2  -2.2  -0.2   2.8   5.6  -1.4  -5.4  -7.4   9.6  -6.4   4.6  -0.4  -0.4 
   40 
  1.6 </code></pre>
</div>
</div>
<!-- ## Residuals $e_{ij} = y_{ij} - \bar{y}_{i\cdot}$  -->
<!-- -We have relatively large total sample size $n_T = 40$. -->
<p>The residuals must look like a normal distribution. The normal probability plot is somewhat close to a straight line.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="model-anova_files/figure-html/unnamed-chunk-41-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The Shapiro test and Anderson-Darling test give us a different conclusion. We could either transform the data to make it look more normal, or collect more data points to gain more information about how the data are distributed.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  oxygen_fit$residuals
W = 0.95469, p-value = 0.1101</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Anderson-Darling normality test

data:  oxygen_fit$residuals
A = 0.87454, p-value = 0.02271</code></pre>
</div>
</div>
<!-- ## Fitted Values versus Residuals -->
<p><strong>Residual plots</strong> is another good way to check the model assumptions, especially whether or not the homogeneity of variance is hold. A residual plot is a scatterplot of <span class="math inline">\(e_{ij}\)</span> (y-axis) versus <span class="math inline">\(\hat{y}_{ij}\)</span> (x-axis).</p>
<!-- - Scatterplot of $\hat{y}_{ij}$ versus $e_{ij}$ -->
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">oxygen_fit</span><span class="op">$</span><span class="va">fitted.values</span>, y <span class="op">=</span> <span class="va">oxygen_fit</span><span class="op">$</span><span class="va">residuals</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="model-anova_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>If the homogeneity of variance holds, the residual points should be scattered around value 0 with the same degree of spreadness. Due to the cone shape, we see that the residual variance is increasing with the fitted values or kilometers, a sign of non-constant variances. We can conclude that <span class="math inline">\(Var(\epsilon_{ij})\)</span> is not constant. We can further say that this variance is a function of <span class="math inline">\(\bar{y}_{i\cdot}\)</span>.</p>
<!-- ## Correct Analysis Based on Transformed Data -->
<p>Since the model assumptions are violated, we transform our data to correct unequal variances. As we learned in the previous section, we use the transformation <span class="math inline">\(Y_T = \sqrt{Y + 0.375}\)</span>. The transformed data set is called <code>data_oxygen_tidy_trans</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">data_oxygen_tidy_trans</span> <span class="op">&lt;-</span> <span class="va">data_oxygen_tidy</span></span>
<span><span class="va">data_oxygen_tidy_trans</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="va">data_oxygen_tidy</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span> <span class="op">+</span> <span class="fl">0.375</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We then fit ANOVA model on the transformed data.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="va">oxygen_fit_trans</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">oxygen</span> <span class="op">~</span> <span class="va">km</span>, data <span class="op">=</span> <span class="va">data_oxygen_tidy_trans</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">oxygen_fit_trans</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: oxygen
          Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
km         3 113.095  37.698   153.3 &lt; 2.2e-16 ***
Residuals 36   8.853   0.246                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p>We can check the model assumptions on the transformed data too to make sure that fitting ANOVA to the data makes sense.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="model-anova_files/figure-html/unnamed-chunk-47-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1104"></p>
</figure>
</div>
</div>
</div>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  oxygen_fit_trans$residuals
W = 0.97324, p-value = 0.4529</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Anderson-Darling normality test

data:  oxygen_fit_trans$residuals
A = 0.33815, p-value = 0.4855</code></pre>
</div>
</div>
<p>From the qqplot and the testing results we can see that the transformed data are more like a normal distribution. There is no significant pattern in the residual plot, showing that unequal variances have been corrected.</p>
<p>This result is more convincing than the one using the original data that violates the ANOVA model assumptions. Although the two models both reject the null hypothesis, the numerical results obtained from the transformed data interpret the relationship between the response and the factors more accurately.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/anova.html">anova</a></span><span class="op">(</span><span class="va">oxygen_fit</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: oxygen
          Df Sum Sq Mean Sq F value    Pr(&gt;F)    
km         3 5793.1 1931.03   129.7 &lt; 2.2e-16 ***
Residuals 36  536.0   14.89                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<!-- ## Checking Asumptions Based on Transformed Data -->
</section></section><section id="nonparametric-approach-kruskal-wallis-test" class="level2" data-number="23.6"><h2 data-number="23.6" class="anchored" data-anchor-id="nonparametric-approach-kruskal-wallis-test">
<span class="header-section-number">23.6</span> Nonparametric Approach: Kruskal-Wallis Test</h2>
<p>In ANOVA, the sample from each factor level is from a normal population. What if the distribution is <strong>non-normal</strong>? One solution is to use the <strong>Kruskal-Wallis test</strong>, which can be viewed as a generalization of the Wilcoxon rank sum test (Mann-Whitney U test). Suppose we have <span class="math inline">\(k\)</span> samples from <span class="math inline">\(k\)</span> populations. We like to test the hypothesis that the <span class="math inline">\(k\)</span> samples were drawn from populations with the same <strong>median</strong>:</p>
<ul>
<li><span style="color:blue"> <span class="math inline">\(\begin{align}
&amp;H_0: \text{All $k$ populations have the same median}\\
&amp;H_1: \text{Not all the medians are the same}
\end{align}\)</span> </span></li>
</ul>
<p>The requirements of the Kruskal-Wallis test are</p>
<ul>
<li>At least 3 <strong>independent</strong> samples</li>
<li>Each sample has at least 5 observations for approximating a <span class="math inline">\(\chi^2\)</span> distribution. If samples have fewer than 5 observations, the <span class="math inline">\(\chi^2\)</span> approximation doe snot work well, and another way to find critical values is needed.</li>
</ul>
<p>There is <strong>no</strong> requirement that the populations have a normal distribution or any other particular distribution.</p>
<p>The testing details are skipped here, but letâ€™s see how we can perform this test to answer our question when the normality assumption of ANOVA is not satisfied.</p>
<hr>
<p><span style="color:blue"> <strong>Example: <code>airquality</code> data</strong> </span></p>
<p>We use the R built-in data set <code>airquality</code> for illustration. The data collected daily air quality measurements in New York, May to September 1973.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="va">airquality</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   153 obs. of  6 variables:
 $ Ozone  : int  41 36 12 18 NA 28 23 19 8 NA ...
 $ Solar.R: int  190 118 149 313 NA NA 299 99 19 194 ...
 $ Wind   : num  7.4 8 12.6 11.5 14.3 14.9 8.6 13.8 20.1 8.6 ...
 $ Temp   : int  67 72 74 62 56 66 65 59 61 69 ...
 $ Month  : int  5 5 5 5 5 5 5 5 5 5 ...
 $ Day    : int  1 2 3 4 5 6 7 8 9 10 ...</code></pre>
</div>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">airquality</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Ozone Solar.R Wind Temp Month Day
1    41     190  7.4   67     5   1
2    36     118  8.0   72     5   2
3    12     149 12.6   74     5   3
4    18     313 11.5   62     5   4
5    NA      NA 14.3   56     5   5
6    28      NA 14.9   66     5   6</code></pre>
</div>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="co">## remove observations with missing values using complete.cases()</span></span>
<span><span class="va">air_data</span> <span class="op">&lt;-</span> <span class="va">airquality</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/stats/complete.cases.html">complete.cases</a></span><span class="op">(</span><span class="va">airquality</span><span class="op">)</span>, <span class="op">]</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Our goal is to test at .05 significance level if the monthly ozone densities in New York have the same median from May to September 1973.</p>
<p>First letâ€™s check the normality assumption. We can use <code><a href="https://rdrr.io/r/stats/qqnorm.html">qqnorm()</a></code>, but here the function <code><a href="https://rdrr.io/pkg/car/man/qqPlot.html">qqPlot()</a></code> from the <code>car</code> package is used. The blue shaded area shows the 95% confidence interval for straight line that indicates normality. Since there are not many observations in each group May to September, it may be hard to see whether normality is satisfied for every group.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://r-forge.r-project.org/projects/car/">car</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mgp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2.5</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">car</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/car/man/qqPlot.html">qqPlot</a></span><span class="op">(</span><span class="va">Ozone</span> <span class="op">~</span> <span class="va">Month</span>, data <span class="op">=</span> <span class="va">air_data</span>, layout<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure class="figure"><p><img src="model-anova_files/figure-html/normality-air-1.png" class="img-fluid quarto-figure quarto-figure-center figure-img" width="1152"></p>
</figure>
</div>
</div>
</div>
<!-- kruskal.test(Ozone ~ Month, data = airquality)  -->
<p>What we can do is to use a more formal testing procedure to decide whether are not the normality is satisfied. There are several methods for normality test out there such as <strong>Kolmogorov-Smirnov (K-S) test</strong>, <strong>Shapiro-Wilkâ€™s test</strong>, and <strong>Anderson-Darling test</strong>.</p>
<p>The K-S test can be used to compare a sample against any reference distribution, not just the normal distribution. However, the K-S test is more focused on the central part of the distribution and might miss deviations in the tails. It is generally less powerful for detecting deviations from normality compared to other tests like the Shapiro-Wilk or Anderson-Darling tests.</p>
<p>The Shapiro-Wilk test is specifically designed to assess the normality of a distribution. It is generally more powerful than the K-S and Anderson-Darling tests for detecting departures from normality, especially in small to moderately sized samples. The Anderson-Darling test is a modification of the K-S test and gives more weight to the tails of the distribution.</p>
<!-- https://www.ncbi.nlm.nih.gov/pmc/articles/PMC3693611/ -->
<p>When we do the normality test, the null hypothesis of these tests is that <em>â€œsample distribution IS normalâ€</em>. If the test is significant, the distribution is non-normal.</p>
<p>To perform Shapiro-Wilk test, we use <code><a href="https://rdrr.io/r/stats/shapiro.test.html">shapiro.test()</a></code> function in R. Note that May and Semptember are not normal.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  air_data[air_data$Month == 5, 1]
W = 0.71273, p-value = 1.491e-05</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Shapiro-Wilk normality test

data:  air_data[air_data$Month == 9, 1]
W = 0.78373, p-value = 4.325e-05</code></pre>
</div>
</div>
<p>To perform Anderson-Darling test, we use <code><a href="https://rdrr.io/pkg/nortest/man/ad.test.html">ad.test()</a></code> function in the R package <code>nortest</code>.</p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">nortest</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/nortest/man/ad.test.html">ad.test</a></span><span class="op">(</span><span class="va">air_data</span><span class="op">[</span><span class="va">air_data</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="fl">5</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Anderson-Darling normality test

data:  air_data[air_data$Month == 5, 1]
A = 1.7452, p-value = 0.0001286</code></pre>
</div>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/nortest/man/ad.test.html">ad.test</a></span><span class="op">(</span><span class="va">air_data</span><span class="op">[</span><span class="va">air_data</span><span class="op">$</span><span class="va">Month</span> <span class="op">==</span> <span class="fl">9</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Anderson-Darling normality test

data:  air_data[air_data$Month == 9, 1]
A = 2.4088, p-value = 2.943e-06</code></pre>
</div>
</div>
<p>For the K-S test, we use <code><a href="https://rdrr.io/r/stats/ks.test.html">ks.test()</a></code> function. We need to add â€œpnormâ€ in the function, so that it knows you are comparing your data with the normal distribution.</p>
<div class="cell" data-layout-align="center">
<div class="cell-output cell-output-stderr">
<pre><code>Warning in ks.test.default(air_data[air_data$Month == 5, 1], "pnorm"): ties
should not be present for the one-sample Kolmogorov-Smirnov test</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Asymptotic one-sample Kolmogorov-Smirnov test

data:  air_data[air_data$Month == 5, 1]
D = 0.9583, p-value &lt; 2.2e-16
alternative hypothesis: two-sided</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in ks.test.default(air_data[air_data$Month == 9, 1], "pnorm"): ties
should not be present for the one-sample Kolmogorov-Smirnov test</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Asymptotic one-sample Kolmogorov-Smirnov test

data:  air_data[air_data$Month == 9, 1]
D = 1, p-value &lt; 2.2e-16
alternative hypothesis: two-sided</code></pre>
</div>
</div>
<p>We just conform that not all sub-samples are normally distributed, and using the Kruskal-Wallis test could be making more sense. It is super easy to perform the Kruskal-Wallis test. Just one line of code with the formula as <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> in the <code><a href="https://rdrr.io/r/stats/kruskal.test.html">kruskal.test()</a></code> function. <!-- - Just one line of code in R to do Kruskal-Wallis test! --></p>
<div class="cell" data-layout-align="center">
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r code-with-copy"><code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/kruskal.test.html">kruskal.test</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">Ozone</span> <span class="op">~</span> <span class="va">Month</span>, data <span class="op">=</span> <span class="va">air_data</span><span class="op">)</span> </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Kruskal-Wallis rank sum test

data:  Ozone by Month
Kruskal-Wallis chi-squared = 26.309, df = 4, p-value = 2.742e-05</code></pre>
</div>
</div>
<p>Itâ€™s an (approximate) <span class="math inline">\(\chi^2\)</span> test with degrees of freedom <span class="math inline">\(k-1\)</span>. Here, we have <span class="math inline">\(k=5\)</span> months. Since <span class="math inline">\(p\)</span>-value is approaching to 0, we reject <span class="math inline">\(H_0\)</span>. We conclude that there is sufficient evidence to reject the claim that the 5 monthly ozone densities in New York have the same median.</p>
<!-- ## Pairwise Comparison -->
<!-- ## Two-Way ANOVA* -->
<!-- To be added. -->


</section><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><hr>
<ol>
<li id="fn1"><p>The test I use is Brown-Forsythe test. It can be performed using the function <code>onewaytests::bf.test()</code>.<a href="#fnref1" class="footnote-back" role="doc-backlink">â†©ï¸Ž</a></p></li>
<li id="fn2"><p>There are several tests for normality, such as Shapiroâ€“Wilk test (<code><a href="https://rdrr.io/r/stats/shapiro.test.html">stats::shapiro.test()</a></code>), Andersonâ€“Darling test (<code><a href="https://rdrr.io/pkg/nortest/man/ad.test.html">nortest::ad.test()</a></code>), and Kolmogorovâ€“Smirnov test (<code><a href="https://rdrr.io/r/stats/ks.test.html">stats::ks.test()</a></code>).<a href="#fnref2" class="footnote-back" role="doc-backlink">â†©ï¸Ž</a></p></li>
</ol></section></main><!-- /main --><script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "î§‹";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/chenghanyu-introstatsbook\.netlify\.app\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script><nav class="page-navigation"><div class="nav-page nav-page-previous">
      <a href="./model.html" class="pagination-link" aria-label="Statistical Models">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Statistical Models</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./model-multicomp.html" class="pagination-link" aria-label="Multiple Comparison*">
        <span class="nav-page-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">Multiple Comparison*</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer"><div class="nav-footer">
    <div class="nav-footer-left">
<p>Copyright 2024, Dr.&nbsp;Cheng-Han Yu</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    <div class="toc-actions d-sm-block d-md-none"><ul><li><a href="https://github.com/chenghanyustats/introstatsbook/edit/main/model-anova.qmd" class="toc-action"><i class="bi bi-github"></i>Edit this page</a></li><li><a href="https://github.com/chenghanyustats/introstatsbook/issues/new" class="toc-action"><i class="bi empty"></i>Report an issue</a></li></ul></div></div>
    <div class="nav-footer-right">
      <ul class="footer-items list-unstyled">
<li class="nav-item compact">
    <a class="nav-link active" href="https://github.com/chenghanyustats/introstatsbook" aria-current="page">
      <i class="bi bi-github" role="img">
</i> 
    </a>
  </li>  
</ul>
</div>
  </div>
</footer>


</body></html>